{"ast":null,"code":"import _objectSpread from\"/Users/devanshgoenka/Desktop/seva/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/components/DashboardUser.jsx\nimport React,{useEffect,useState}from\"react\";import ReportForm from\"./ReportForm\";import ReportList from\"./ReportList\";import ReportView from\"./ReportView\";import MapView from\"./MapView\";import api from\"../api/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function DashboardUser(_ref){let{user}=_ref;const[reports,setReports]=useState([]);const[mode,setMode]=useState(null);const[viewReport,setViewReport]=useState(null);useEffect(()=>{refreshReports();},[]);async function refreshReports(){if(process.env.REACT_APP_API_BASE){try{const res=await api.getReports();setReports(res);return;}catch(err){console.warn(\"API getReports failed\",err);}}setReports(JSON.parse(localStorage.getItem('seva_reports')||'[]'));}function handleNewReportSaved(r){refreshReports();setMode(null);}function handleView(r){setViewReport(r);}function closeView(){setViewReport(null);}async function handleVote(id){if(process.env.REACT_APP_API_BASE){await api.voteReport(id).catch(()=>{});await refreshReports();return;}const arr=reports.map(r=>r.id===id?_objectSpread(_objectSpread({},r),{},{votes:(r.votes||0)+1}):r);localStorage.setItem('seva_reports',JSON.stringify(arr));setReports(arr);}async function handleCompleteVote(id){if(process.env.REACT_APP_API_BASE){await api.completeVoteReport(id).catch(()=>{});await refreshReports();return;}const arr=reports.map(r=>r.id===id?_objectSpread(_objectSpread({},r),{},{completedVotes:(r.completedVotes||0)+1}):r);localStorage.setItem('seva_reports',JSON.stringify(arr));setReports(arr);}async function handleComment(id,comment){if(process.env.REACT_APP_API_BASE){await api.commentReport(id,comment).catch(()=>{});await refreshReports();return;}const arr=reports.map(r=>r.id===id?_objectSpread(_objectSpread({},r),{},{comments:[...(r.comments||[]),comment]}):r);localStorage.setItem('seva_reports',JSON.stringify(arr));setReports(arr);}// build marker objects including assignedName and author\nfunction buildMarkers(){const auths=localStorage.getItem('seva_authorities')?JSON.parse(localStorage.getItem('seva_authorities')):[];const byId={};for(const a of auths)byId[a.id]=a;return reports.filter(r=>r.lat&&r.lng).map(r=>{var _byId$r$assignedTo;return{id:r.id,lat:parseFloat(r.lat),lng:parseFloat(r.lng),title:r.title,desc:r.desc,author:r.createdBy||r.author||\"anonymous\",assignedTo:r.assignedTo,assignedName:r.assignedTo?((_byId$r$assignedTo=byId[r.assignedTo])===null||_byId$r$assignedTo===void 0?void 0:_byId$r$assignedTo.name)||r.assignedTo:\"Not assigned\"};});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"User Dashboard\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"muted\",children:[\"Welcome \",(user===null||user===void 0?void 0:user.username)||\"User\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:16,marginBottom:18},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",style:{padding:'16px 24px'},onClick:()=>setMode(\"submit\"),children:\"Submit New Report\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-outline\",style:{padding:'16px 24px'},onClick:()=>setMode(\"browse\"),children:\"Browse Reports\"})]}),mode===\"submit\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Submit New Report\"}),/*#__PURE__*/_jsx(ReportForm,{onSave:handleNewReportSaved})]}),mode===\"browse\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"All Reports\"}),/*#__PURE__*/_jsx(ReportList,{reports:reports,onView:handleView,onVote:handleVote,onCompleteVote:handleCompleteVote})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:18},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Map \\u2014 reports with location\"}),/*#__PURE__*/_jsx(MapView,{markers:buildMarkers(),height:\"450px\",onMarkerClick:m=>{// find report by id and open it\nconst r=reports.find(x=>x.id===m.id);if(r)setViewReport(r);}})]}),viewReport&&/*#__PURE__*/_jsx(ReportView,{report:viewReport,onClose:closeView,onComment:handleComment,user:user})]});}","map":{"version":3,"names":["React","useEffect","useState","ReportForm","ReportList","ReportView","MapView","api","jsx","_jsx","jsxs","_jsxs","DashboardUser","_ref","user","reports","setReports","mode","setMode","viewReport","setViewReport","refreshReports","process","env","REACT_APP_API_BASE","res","getReports","err","console","warn","JSON","parse","localStorage","getItem","handleNewReportSaved","r","handleView","closeView","handleVote","id","voteReport","catch","arr","map","_objectSpread","votes","setItem","stringify","handleCompleteVote","completeVoteReport","completedVotes","handleComment","comment","commentReport","comments","buildMarkers","auths","byId","a","filter","lat","lng","_byId$r$assignedTo","parseFloat","title","desc","author","createdBy","assignedTo","assignedName","name","className","children","username","style","display","gap","marginBottom","padding","onClick","onSave","onView","onVote","onCompleteVote","marginTop","markers","height","onMarkerClick","m","find","x","report","onClose","onComment"],"sources":["/Users/devanshgoenka/Desktop/seva/frontend/src/components/DashboardUser.jsx"],"sourcesContent":["// src/components/DashboardUser.jsx\nimport React, { useEffect, useState } from \"react\";\nimport ReportForm from \"./ReportForm\";\nimport ReportList from \"./ReportList\";\nimport ReportView from \"./ReportView\";\nimport MapView from \"./MapView\";\nimport api from \"../api/api\";\n\nexport default function DashboardUser({ user }){\n  const [reports, setReports] = useState([]);\n  const [mode, setMode] = useState(null);\n  const [viewReport, setViewReport] = useState(null);\n\n  useEffect(()=> {\n    refreshReports();\n  }, []);\n\n  async function refreshReports(){\n    if(process.env.REACT_APP_API_BASE){\n      try {\n        const res = await api.getReports();\n        setReports(res);\n        return;\n      } catch(err){\n        console.warn(\"API getReports failed\", err);\n      }\n    }\n    setReports(JSON.parse(localStorage.getItem('seva_reports')||'[]'));\n  }\n\n  function handleNewReportSaved(r){\n    refreshReports();\n    setMode(null);\n  }\n\n  function handleView(r){ setViewReport(r); }\n  function closeView(){ setViewReport(null); }\n\n  async function handleVote(id){\n    if(process.env.REACT_APP_API_BASE){\n      await api.voteReport(id).catch(()=>{});\n      await refreshReports();\n      return;\n    }\n    const arr = reports.map(r => r.id === id ? {...r, votes: (r.votes||0)+1 } : r);\n    localStorage.setItem('seva_reports', JSON.stringify(arr));\n    setReports(arr);\n  }\n\n  async function handleCompleteVote(id){\n    if(process.env.REACT_APP_API_BASE){\n      await api.completeVoteReport(id).catch(()=>{});\n      await refreshReports();\n      return;\n    }\n    const arr = reports.map(r => r.id === id ? {...r, completedVotes: (r.completedVotes||0)+1 } : r);\n    localStorage.setItem('seva_reports', JSON.stringify(arr));\n    setReports(arr);\n  }\n\n  async function handleComment(id, comment){\n    if(process.env.REACT_APP_API_BASE){\n      await api.commentReport(id, comment).catch(()=>{});\n      await refreshReports();\n      return;\n    }\n    const arr = reports.map(r => r.id === id ? {...r, comments:[...(r.comments||[]), comment]} : r);\n    localStorage.setItem('seva_reports', JSON.stringify(arr));\n    setReports(arr);\n  }\n\n  // build marker objects including assignedName and author\n  function buildMarkers() {\n    const auths = (localStorage.getItem('seva_authorities') ? JSON.parse(localStorage.getItem('seva_authorities')) : []);\n    const byId = {};\n    for(const a of auths) byId[a.id] = a;\n\n    return reports.filter(r => r.lat && r.lng).map(r => ({\n      id: r.id,\n      lat: parseFloat(r.lat),\n      lng: parseFloat(r.lng),\n      title: r.title,\n      desc: r.desc,\n      author: r.createdBy || r.author || \"anonymous\",\n      assignedTo: r.assignedTo,\n      assignedName: r.assignedTo ? (byId[r.assignedTo]?.name || r.assignedTo) : \"Not assigned\"\n    }));\n  }\n\n  return (\n    <div className=\"container\">\n      <h2>User Dashboard</h2>\n      <p className=\"muted\">Welcome {user?.username || \"User\"}</p>\n\n      <div style={{display:'flex', gap:16, marginBottom:18}}>\n        <button className=\"btn\" style={{padding:'16px 24px'}} onClick={()=>setMode(\"submit\")}>Submit New Report</button>\n        <button className=\"btn-outline\" style={{padding:'16px 24px'}} onClick={()=>setMode(\"browse\")}>Browse Reports</button>\n      </div>\n\n      {mode === \"submit\" && (\n        <div className=\"card\">\n          <h3>Submit New Report</h3>\n          <ReportForm onSave={handleNewReportSaved} />\n        </div>\n      )}\n\n      {mode === \"browse\" && (\n        <div className=\"card\">\n          <h3>All Reports</h3>\n          <ReportList reports={reports} onView={handleView} onVote={handleVote} onCompleteVote={handleCompleteVote} />\n        </div>\n      )}\n\n      <div style={{marginTop:18}}>\n        <h3>Map â€” reports with location</h3>\n        <MapView\n          markers={buildMarkers()}\n          height=\"450px\"\n          onMarkerClick={(m)=> {\n            // find report by id and open it\n            const r = reports.find(x => x.id === m.id);\n            if(r) setViewReport(r);\n          }}\n        />\n      </div>\n\n      {viewReport && <ReportView report={viewReport} onClose={closeView} onComment={handleComment} user={user} />}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}