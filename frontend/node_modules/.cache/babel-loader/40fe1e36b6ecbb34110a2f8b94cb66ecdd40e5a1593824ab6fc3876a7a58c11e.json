{"ast":null,"code":"import React,{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import api from\"../api/api\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function AuthForm(_ref){let{mode=\"login\",onAuth}=_ref;const[username,setUsername]=useState(\"\");const[password,setPassword]=useState(\"\");const[role,setRole]=useState(\"user\");const[confirm,setConfirm]=useState(\"\");const navigate=useNavigate();async function handleSubmit(e){e.preventDefault();// If backend exists, attempt API call. Otherwise fallback to localStorage.\nif(process.env.REACT_APP_API_BASE){try{if(mode===\"signup\"){if(password!==confirm){alert(\"Passwords must match\");return;}const res=await api.signup({username,password,role});// NEW: do NOT auto-login – show success and go to login page\nalert(\"Signup successful. Please login to continue.\");navigate(\"/login\");return;}else{const res=await api.login({username,password,role});// Successful login -> call onAuth to set session and redirect to dashboard\nonAuth({username:res.username,role:res.role});return;}}catch(err){// fallback to localStorage mode if API failed\nconsole.warn(\"API auth failed, falling back to localStorage\",err);}}// Fallback localStorage logic (demo)\nconst usersRaw=localStorage.getItem(\"seva_accounts\")||\"[]\";const accounts=JSON.parse(usersRaw);if(mode===\"signup\"){if(password!==confirm){alert(\"Passwords must match\");return;}const exists=accounts.find(a=>a.username===username&&a.role===role);if(exists){alert(\"Account exists for this role\");return;}const newAcc={id:Date.now(),username,password,role};accounts.push(newAcc);localStorage.setItem(\"seva_accounts\",JSON.stringify(accounts));// NEW: do NOT auto-login — show a message and redirect to login page\nalert(\"Signup successful. Please login to continue.\");navigate(\"/login\");}else{const match=accounts.find(a=>a.username===username&&a.password===password&&a.role===role);if(!match){alert(\"Invalid credentials\");return;}onAuth({username,role});}}return/*#__PURE__*/_jsxs(\"div\",{className:\"form-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:mode===\"signup\"?\"Signup\":\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Role\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"role-row\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",checked:role===\"user\",onChange:()=>setRole(\"user\")}),\" User\"]}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",checked:role===\"admin\",onChange:()=>setRole(\"admin\")}),\" Admin\"]}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",checked:role===\"authority\",onChange:()=>setRole(\"authority\")}),\" Authority\"]})]}),/*#__PURE__*/_jsx(\"label\",{children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{required:true,value:username,onChange:e=>setUsername(e.target.value)}),/*#__PURE__*/_jsx(\"label\",{children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{required:true,type:\"password\",value:password,onChange:e=>setPassword(e.target.value)}),mode===\"signup\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Confirm Password\"}),/*#__PURE__*/_jsx(\"input\",{required:true,type:\"password\",value:confirm,onChange:e=>setConfirm(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",type:\"submit\",children:mode===\"signup\"?\"Create account\":\"Login\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-outline\",onClick:()=>navigate(\"/\"),children:\"Back\"})]})]})]});}","map":{"version":3,"names":["React","useState","useNavigate","api","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AuthForm","_ref","mode","onAuth","username","setUsername","password","setPassword","role","setRole","confirm","setConfirm","navigate","handleSubmit","e","preventDefault","process","env","REACT_APP_API_BASE","alert","res","signup","login","err","console","warn","usersRaw","localStorage","getItem","accounts","JSON","parse","exists","find","a","newAcc","id","Date","now","push","setItem","stringify","match","className","children","onSubmit","type","checked","onChange","required","value","target","onClick"],"sources":["/Users/devanshgoenka/Desktop/seva/frontend/src/components/AuthForm.jsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport api from \"../api/api\";\n\nexport default function AuthForm({ mode=\"login\", onAuth }){\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [role, setRole] = useState(\"user\");\n  const [confirm, setConfirm] = useState(\"\");\n  const navigate = useNavigate();\n\n  async function handleSubmit(e){\n    e.preventDefault();\n\n    // If backend exists, attempt API call. Otherwise fallback to localStorage.\n    if(process.env.REACT_APP_API_BASE){\n      try {\n        if(mode === \"signup\"){\n          if(password !== confirm){ alert(\"Passwords must match\"); return; }\n          const res = await api.signup({ username, password, role });\n          // NEW: do NOT auto-login – show success and go to login page\n          alert(\"Signup successful. Please login to continue.\");\n          navigate(\"/login\");\n          return;\n        } else {\n          const res = await api.login({ username, password, role });\n          // Successful login -> call onAuth to set session and redirect to dashboard\n          onAuth({ username: res.username, role: res.role });\n          return;\n        }\n      } catch(err){\n        // fallback to localStorage mode if API failed\n        console.warn(\"API auth failed, falling back to localStorage\", err);\n      }\n    }\n\n    // Fallback localStorage logic (demo)\n    const usersRaw = localStorage.getItem(\"seva_accounts\") || \"[]\";\n    const accounts = JSON.parse(usersRaw);\n\n    if(mode === \"signup\"){\n      if(password !== confirm){ alert(\"Passwords must match\"); return; }\n      const exists = accounts.find(a => a.username === username && a.role === role);\n      if(exists) { alert(\"Account exists for this role\"); return; }\n      const newAcc = { id: Date.now(), username, password, role };\n      accounts.push(newAcc);\n      localStorage.setItem(\"seva_accounts\", JSON.stringify(accounts));\n      // NEW: do NOT auto-login — show a message and redirect to login page\n      alert(\"Signup successful. Please login to continue.\");\n      navigate(\"/login\");\n    } else {\n      const match = accounts.find(a => a.username === username && a.password === password && a.role === role);\n      if(!match){ alert(\"Invalid credentials\"); return; }\n      onAuth({ username, role });\n    }\n  }\n\n  return (\n    <div className=\"form-card\">\n      <h3>{mode === \"signup\" ? \"Signup\" : \"Login\"}</h3>\n      <form onSubmit={handleSubmit}>\n        <label>Role</label>\n        <div className=\"role-row\">\n          <label><input type=\"radio\" checked={role===\"user\"} onChange={()=>setRole(\"user\")} /> User</label>\n          <label><input type=\"radio\" checked={role===\"admin\"} onChange={()=>setRole(\"admin\")} /> Admin</label>\n          <label><input type=\"radio\" checked={role===\"authority\"} onChange={()=>setRole(\"authority\")} /> Authority</label>\n        </div>\n        <label>Username</label>\n        <input required value={username} onChange={e=>setUsername(e.target.value)} />\n        <label>Password</label>\n        <input required type=\"password\" value={password} onChange={e=>setPassword(e.target.value)} />\n        {mode === \"signup\" && <>\n          <label>Confirm Password</label>\n          <input required type=\"password\" value={confirm} onChange={e=>setConfirm(e.target.value)} />\n        </>}\n        <div className=\"form-row\">\n          <button className=\"btn\" type=\"submit\">{mode === \"signup\" ? \"Create account\" : \"Login\"}</button>\n          <button type=\"button\" className=\"btn-outline\" onClick={()=>navigate(\"/\")}>Back</button>\n        </div>\n      </form>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}